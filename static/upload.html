<!DOCTYPE html>
<html>
<style>
    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        font-family: Arial;
    }

    .header {
        text-align: center;
        padding: 32px;
    }

    .row {
        display: -ms-flexbox;
        /* IE 10 */
        display: flex;
        -ms-flex-wrap: wrap;
        /* IE 10 */
        flex-wrap: wrap;
        padding: 0 4px;
    }

    /* Create two equal columns that sits next to each other */

    .column {
        -ms-flex: 50%;
        /* IE 10 */
        flex: 50%;
        padding: 0 4px;
    }

    .column img {
        margin-top: 8px;
        vertical-align: middle;
    }

    /* Style the buttons */

    .btn {
        border: none;
        outline: none;
        padding: 10px 16px;
        background-color: #f1f1f1;
        cursor: pointer;
        font-size: 18px;
    }

    .btn:hover {
        background-color: #ddd;
    }

    .btn.active {
        background-color: #666;
        color: white;
    }

    .ublock {
        position: relative;
        border: 3px solid #73AD21;
        top: 5px;
        left: 5px;
        right: 5px;
        font-size: 18px;
    }
</style>

<body>
    <form name="uploadForm" class="ublock" enctype="multipart/form-data" method="post">
        What is the image files to upload?
        <input type="file" id="image" name="uploadedfile" accept="image/jpeg, image/png">
        <br />
        <div id="outputDiv"></div>
        <input type="button" value="Send" onclick="uploadImage()">
        <input type="reset">
    </form>

    <!-- Header -->
    <div class="header" id="myHeader">
        <h1>Image Grid</h1>
        <p>Click on the buttons to change the grid view.</p>
        <button class="btn" onclick="one()">1</button>
        <button class="btn active" onclick="two()">2</button>
        <button class="btn" onclick="four()">4</button>
    </div>

    <!-- Photo Grid -->
    <div class="row">

    </div>
    <script src="script/main.js"></script>
    <script type="text/javascript">

        function uploadImage() {
            alert("abc");
            var file = document.getElementById('image');
            upload(file.files[0], "abc", "image/png");
            // var xhr = new XMLHttpRequest();
            // xhr.open("post", "http://localhost:8080/image/upload", false)
            // xhr.send()
            //uploadImage(imgsrc, name, 'image/'+)
        };

        // This function accepts three arguments, the URL of the image to be 
        // converted, the mime type of the Base64 image to be output, and a 
        // callback function that will be called with the data URL as its argument 
        // once processing is complete
        var convertToBase64 = function (url, imagetype, callback) {

            var img = document.createElement('IMG'),
                canvas = document.createElement('CANVAS'),
                ctx = canvas.getContext('2d'),
                data = '';

            // Set the crossOrigin property of the image element to 'Anonymous',
            // allowing us to load images from other domains so long as that domain 
            // has cross-origin headers properly set

            img.crossOrigin = 'Anonymous'

            // Because image loading is asynchronous, we define an event listening function that will be called when the image has been loaded
            img.onLoad = function () {
                // When the image is loaded, this function is called with the image object as its context or 'this' value
                canvas.height = this.height;
                canvas.width = this.width;
                ctx.drawImage(this, 0, 0);
                data = canvas.toDataURL(imagetype);
                callback(data);
            };

            // We set the source of the image tag to start loading its data. We define 
            // the event listener first, so that if the image has already been loaded 
            // on the page or is cached the event listener will still fire

            img.src = url;
        };

        // Here we define the function that will send the request to the server. 
        // It will accept the image name, and the base64 data as arguments
        var sendBase64ToServer = function (name, base64) {
            var httpPost = new XMLHttpRequest(),
                path = "http://localhost:8000/image/upload?username=" + getFirstCookieName(),
                data = JSON.stringify({ image: base64 });
            httpPost.onreadystatechange = function (err) {
                if (httpPost.readyState == 4 && httpPost.status == 200) {
                    console.log(httpPost.responseText);
                } else {
                    console.log(err);
                }
            };
            // Set the content type of the request to json since that's what's being sent
            httpPost.setHeader('Content-Type', 'application/json');
            httpPost.open("POST", path, true);
            httpPost.send(data);
        };

        // This wrapper function will accept the name of the image, the url, and the 
        // image type and perform the request
        var upload = function (src, name, type) {
            convertToBase64(src, type, function (data) {
                sendBase64ToServer(name, data);
            });
        };
    </script>

</body>

</html>